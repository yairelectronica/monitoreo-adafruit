<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard PIC â€“ Firebase</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: linear-gradient(180deg, #dff1ff, #b5d9ff);
        padding: 20px;
        text-align: center;
    }

    h1 { color: #2c3e50; }

    .contenedor {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
        margin-top: 20px;
    }

    .card {
        width: 250px;
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0px 4px 15px rgba(0,0,0,0.15);
    }

    .valor {
        font-size: 40px;
        margin-top: 10px;
        font-weight: bold;
    }

    .panel {
        margin: 40px auto;
        width: 95%;
        max-width: 900px;
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0px 4px 15px rgba(0,0,0,0.2);
    }

    .selector-fecha {
        margin: 10px 0;
        font-size: 18px;
        padding: 8px;
    }
</style>

</head>
<body>

<h1>Dashboard de Temperatura y Humedad</h1>
<h3>Datos en tiempo real desde Firebase</h3>

<div class="contenedor">
    <div class="card">
        <h2>ðŸŒ¡ Temperatura</h2>
        <div id="temp" class="valor">-- Â°C</div>
    </div>

    <div class="card">
        <h2>ðŸ’§ Humedad</h2>
        <div id="hum" class="valor">-- %</div>
    </div>
</div>

<!-- GRÃFICO EN TIEMPO REAL -->
<div class="panel">
    <h2>ðŸ“Š GrÃ¡fico en Tiempo Real</h2>
    <canvas id="chartRealtime"></canvas>
</div>

<!-- SELECTOR DE FECHA -->
<div class="panel">
    <h2>ðŸ“… Ver historial por dÃ­a</h2>
    <input type="date" id="fechaSeleccion" class="selector-fecha" onchange="cargarHistorial()">
</div>

<!-- GRÃFICO DE HISTORIAL -->
<div class="panel">
    <h2>ðŸ“Š Historial del DÃ­a Seleccionado</h2>
    <canvas id="chartHistorial"></canvas>
</div>

<script>
    // ConfiguraciÃ³n Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyCWbcsCe8tnVR1o5cG3hJHEGs4aTeegRKU",
        authDomain: "databasepic-a8977.firebaseapp.com",
        databaseURL: "https://databasepic-a8977-default-rtdb.firebaseio.com",
        projectId: "databasepic-a8977",
        storageBucket: "databasepic-a8977.firebasestorage.app",
        messagingSenderId: "890321833852",
        appId: "1:890321833852:web:0904650852e0ecd1d9def9"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ---------------------- GRÃFICO EN TIEMPO REAL -----------------------
    const rtChart = new Chart(document.getElementById("chartRealtime"), {
        type: "line",
        data: {
            labels: [],
            datasets: [
                {
                    label: "Temperatura (Â°C)",
                    data: [],
                    borderColor: "#e74c3c",
                    backgroundColor: "rgba(231,76,60,0.2)",
                    fill: true,
                    tension: 0.3
                },
                {
                    label: "Humedad (%)",
                    data: [],
                    borderColor: "#3498db",
                    backgroundColor: "rgba(52,152,219,0.2)",
                    fill: true,
                    tension: 0.3
                }
            ]
        },
        options: { responsive: true }
    });

    // ---------------------- LECTURA EN TIEMPO REAL -----------------------
    db.ref("Actual/temperatura").on("value", snap => {
        let temp = snap.val();
        document.getElementById("temp").innerText = temp + " Â°C";

        let hora = new Date().toLocaleTimeString();
        rtChart.data.labels.push(hora);
        rtChart.data.datasets[0].data.push(temp);
        rtChart.update();
    });

    db.ref("Actual/humedad").on("value", snap => {
        let hum = snap.val();
        document.getElementById("hum").innerText = hum + " %";

        rtChart.data.datasets[1].data.push(hum);
        rtChart.update();
    });

    // ---------------------- GRÃFICO HISTÃ“RICO -----------------------
    const historialChart = new Chart(document.getElementById("chartHistorial"), {
        type: "line",
        data: {
            labels: [],
            datasets: [
                {
                    label: "Temperatura (Â°C)",
                    data: [],
                    borderColor: "#e74c3c",
                    backgroundColor: "rgba(231,76,60,0.2)",
                    fill: true,
                    tension: 0.3
                },
                {
                    label: "Humedad (%)",
                    data: [],
                    borderColor: "#3498db",
                    backgroundColor: "rgba(52,152,219,0.2)",
                    fill: true,
                    tension: 0.3
                }
            ]
        },
        options: { responsive: true }
    });

    // ---------------------- Cargar historial segÃºn fecha -----------------------
    function cargarHistorial() {
        let fecha = document.getElementById("fechaSeleccion").value;
        if (!fecha) return;

        let partes = fecha.split("-");
        let ruta = `Historial/${partes[0]}/${partes[1]}/${partes[2]}`;

        db.ref(ruta).once("value", snap => {
            const data = snap.val();
            if (!data) {
                alert("No hay datos para esta fecha.");
                return;
            }

            let horas = [];
            let temps = [];
            let hums = [];

            Object.keys(data).forEach(hora => {
                horas.push(hora);
                temps.push(data[hora].temperatura);
                hums.push(data[hora].humedad);
            });

            historialChart.data.labels = horas;
            historialChart.data.datasets[0].data = temps;
            historialChart.data.datasets[1].data = hums;
            historialChart.update();
        });
    }
</script>

</body>
</html>



